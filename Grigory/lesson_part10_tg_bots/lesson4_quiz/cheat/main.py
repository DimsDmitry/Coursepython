import telebot
from telebot import types

# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑—å —Å —Å–µ—Ä–≤–µ—Ä–∞–º–∏ Telegram —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω
# –ó–∞–º–µ–Ω–∏ '–í–ê–®_–¢–û–ö–ï–ù' –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á –∏–∑ BotFather
bot = telebot.TeleBot('–í–ê–®_–¢–û–ö–ï–ù')

# –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—á–µ—Ç–∞.
# –û–Ω–∞ –∂–∏–≤–µ—Ç –≤–Ω–µ —Ñ—É–Ω–∫—Ü–∏–π, —á—Ç–æ–±—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–π –≤—Å–µ–º —á–∞—Å—Ç—è–º –ø—Ä–æ–≥—Ä–∞–º–º—ã.
score = 0


# --- –®–ê–ì 1: –ó–ê–ü–£–°–ö –ö–í–ò–ó–ê ---
@bot.message_handler(commands=['start'])
def start_quiz(message):
    """–§—É–Ω–∫—Ü–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –≤–≤–æ–¥–µ /start"""
    global score  # –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –±—É–¥–µ–º –∏–∑–º–µ–Ω—è—Ç—å –≤–Ω–µ—à–Ω—é—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é score
    score = 0  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç –¥–æ –Ω—É–ª—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã

    # InlineKeyboardMarkup —Å–æ–∑–¥–∞–µ—Ç –∫–Ω–æ–ø–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∫—Ä–µ–ø—è—Ç—Å—è –ø—Ä—è–º–æ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
    markup = types.InlineKeyboardMarkup()

    # –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏. callback_data ‚Äî —ç—Ç–æ —Å–∫—Ä—ã—Ç—ã–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±–æ—Ç –ø–æ–ª—É—á–∏—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
    btn1 = types.InlineKeyboardButton("Python", callback_data='q1_correct')
    btn2 = types.InlineKeyboardButton("Java", callback_data='q1_wrong')

    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –æ–±—ä–µ–∫—Ç —Ä–∞–∑–º–µ—Ç–∫–∏ (markup)
    markup.add(btn1, btn2)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
    bot.send_message(message.chat.id, "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ú–µ–≥–∞-–ö–≤–∏–∑!\n\n–í–æ–ø—Ä–æ—Å ‚Ññ1: –ö–∞–∫–æ–π —è–∑—ã–∫ –º—ã —Å–µ–π—á–∞—Å –∏–∑—É—á–∞–µ–º?",
                     reply_markup=markup)


# --- –®–ê–ì 2: –û–ë–†–ê–ë–û–¢–ö–ê –í–°–ï–• –ù–ê–ñ–ê–¢–ò–ô (–õ–û–ì–ò–ö–ê –ò–ì–†–´) ---
@bot.callback_query_handler(func=lambda call: True)
def handle_quiz(call):
    """–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è '—Å–ª—É—à–∞–µ—Ç' –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –ª—é–±—ã–µ Inline-–∫–Ω–æ–ø–∫–∏"""
    global score

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ callback_data –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–∏
    # –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å –ø—Ä–∏–ø–∏—Å–∫–∞ '_correct', –∑–Ω–∞—á–∏—Ç –æ—Ç–≤–µ—Ç –≤–µ—Ä–Ω—ã–π
    if "_correct" in call.data:
        score += 1  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É
        # answer_callback_query —É–±–∏—Ä–∞–µ—Ç '—á–∞—Å–∏–∫–∏' –Ω–∞ –∫–Ω–æ–ø–∫–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        bot.answer_callback_query(call.id, "–í–µ—Ä–Ω–æ! üî•")

    # –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å '_wrong', –æ—Ç–≤–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π
    elif "_wrong" in call.data:
        bot.answer_callback_query(call.id, "–û—à–∏–±–∫–∞! ‚ùå")

    # –õ–û–ì–ò–ö–ê –ü–ï–†–ï–•–û–î–û–í: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞ –∫–∞–∫–æ–º –≤–æ–ø—Ä–æ—Å–µ –º—ã —Å–µ–π—á–∞—Å –Ω–∞—Ö–æ–¥–∏–º—Å—è
    # –∏ –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
    if "q1" in call.data:
        send_question(call.message, 2)  # –ï—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ –∫–Ω–æ–ø–∫—É 1-–≥–æ –≤–æ–ø—Ä–æ—Å–∞ -> –∏–¥–µ–º –∫–æ 2-–º—É
    elif "q2" in call.data:
        send_question(call.message, 3)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º 3-–π –≤–æ–ø—Ä–æ—Å
    elif "q3" in call.data:
        send_question(call.message, 4)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º 4-–π –≤–æ–ø—Ä–æ—Å
    elif "q4" in call.data:
        send_question(call.message, 5)  # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º 5-–π –≤–æ–ø—Ä–æ—Å
    elif "q5" in call.data:
        show_result(call.message)  # –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–æ–ø—Ä–æ—Å -> –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ç–æ–≥


# --- –®–ê–ì 3: –§–£–ù–ö–¶–ò–Ø-–ö–û–ù–°–¢–†–£–ö–¢–û–† –í–û–ü–†–û–°–û–í ---
def send_question(message, num):
    """
    –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ (num) –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.
    –û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç edit_message_text, —á—Ç–æ–±—ã —á–∞—Ç –Ω–µ –∑–∞—Å–æ—Ä—è–ª—Å—è –Ω–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏.
    """
    markup = types.InlineKeyboardMarkup()

    # –£–°–õ–û–í–ù–´–ï –û–ü–ï–†–ê–¢–û–†–´ (IF-ELIF) –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    if num == 2:
        text = "–í–æ–ø—Ä–æ—Å ‚Ññ2: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 'and' –∏ 'or' –≤ –æ–¥–Ω–æ–º —É—Å–ª–æ–≤–∏–∏?"
        btn1 = types.InlineKeyboardButton("–î–∞", callback_data='q2_correct')
        btn2 = types.InlineKeyboardButton("–ù–µ—Ç", callback_data='q2_wrong')
        markup.add(btn1, btn2)

    elif num == 3:
        text = "–í–æ–ø—Ä–æ—Å ‚Ññ3: –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä 'and'?"
        btn1 = types.InlineKeyboardButton("–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –û–ë–ê —É—Å–ª–æ–≤–∏—è –≤–µ—Ä–Ω—ã", callback_data='q3_correct')
        btn2 = types.InlineKeyboardButton("–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –•–û–¢–Ø –ë–´ –û–î–ù–û –≤–µ—Ä–Ω–æ", callback_data='q3_wrong')
        markup.add(btn1, btn2)

    elif num == 4:
        text = "–í–æ–ø—Ä–æ—Å ‚Ññ4: –ö–∞–∫–æ–π —Å–∏–º–≤–æ–ª —Å—Ç–∞–≤–∏—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏ —Å 'if' –∏–ª–∏ 'elif'?"
        btn1 = types.InlineKeyboardButton("–¢–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π (;)", callback_data='q4_wrong')
        btn2 = types.InlineKeyboardButton("–î–≤–æ–µ—Ç–æ—á–∏–µ (:)", callback_data='q4_correct')
        markup.add(btn1, btn2)

    elif num == 5:
        text = "–í–æ–ø—Ä–æ—Å ‚Ññ5: –ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–π –º—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —ç—Ç–æ–≥–æ –±–æ—Ç–∞?"
        btn1 = types.InlineKeyboardButton("PyTelegramBotAPI", callback_data='q5_correct')
        btn2 = types.InlineKeyboardButton("TelePyMaster", callback_data='q5_wrong')
        markup.add(btn1, btn2)

    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∏ –∫–Ω–æ–ø–∫–∏ –Ω–∞ –Ω–æ–≤—ã–µ)
    bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text=text, reply_markup=markup)


# --- –®–ê–ì 4: –§–ò–ù–ê–õ –ò –ü–û–î–í–ï–î–ï–ù–ò–ï –ò–¢–û–ì–û–í ---
def show_result(message):
    """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∑–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–±—Ä–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤"""

    # –°–õ–û–ñ–ù–´–ï –£–°–õ–û–í–ò–Ø –° –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï–ú AND –ò OR
    if score == 5:
        rank = "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç-–õ–µ–≥–µ–Ω–¥–∞! üèÜ"  # –í—Å–µ –æ—Ç–≤–µ—Ç—ã –≤–µ—Ä–Ω—ã
    elif 3 <= score < 5:
        rank = "–ö—Ä–µ–ø–∫–∏–π –Æ–Ω–∏–æ—Ä! üõ†Ô∏è"  # –û—Ç 3 –¥–æ 4 –±–∞–ª–ª–æ–≤ –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
    elif score == 1 or score == 2:
        rank = "–ù–∞—á–∏–Ω–∞—é—â–∏–π –∫–æ–¥–µ—Ä! üå±"  # 1 –∏–ª–∏ 2 –±–∞–ª–ª–∞
    else:
        rank = "–ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –ø—Ä–∞–∫—Ç–∏–∫–∏... üìñ"  # 0 –±–∞–ª–ª–æ–≤

    # –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    final_text = (f"–ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!\n\n"
                  f"–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {score} –∏–∑ 5.\n"
                  f"–¢–≤–æ—ë –∑–≤–∞–Ω–∏–µ: {rank}\n\n"
                  f"–ù–∞–∂–º–∏ /start, —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞!")

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–≤–∏–∑–∞
    bot.edit_message_text(chat_id=message.chat.id, message_id=message.message_id, text=final_text)


# –ó–ê–ü–£–°–ö –ë–û–¢–ê (–¶–∏–∫–ª Polling)
print("–ë–æ—Ç-–ö–≤–∏–∑ –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –≤–æ–ø—Ä–æ—Å–∞–º!")
bot.polling(none_stop=True)